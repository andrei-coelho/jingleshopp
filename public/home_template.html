<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
</head>
<body>

    <button id="play" style="display: none;">play</button>
    <button id="pause">pause</button>

    <script>

        const sources = [];

        function _base64ToArrayBuffer(base64) {
            var binary_string = window.atob(base64);
            var len = binary_string.length;
            var bytes = new Uint8Array(len);
            for (var i = 0; i < len; i++) {
                bytes[i] = binary_string.charCodeAt(i);
            }
            return bytes.buffer;
        }

        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let source;

        async function _request(){

            var ini = 0;

            let req = "http://localhost:8902/api/files/get/"
            const res = await fetch(req, {
                
            });
            const data = await res.json();


            source = audioCtx.createBufferSource();
            audioCtx.decodeAudioData(
                _base64ToArrayBuffer(data.data),
                (buffer) => {
                    source.buffer = buffer;
                    source.connect(audioCtx.destination);
                    source.loop = true;
                },
                (err) => console.error(`Error with decoding audio data: ${err.err}`)
            )
            
            const playButton = document.querySelector("#play");
            playButton.style.display = "inline"
            playButton.addEventListener('click', e => {
                console.log("deu play");
                source.start(0,5);
            })

            document.querySelector("#pause").addEventListener('click', e => {
                source.stop(0);
            })

        }

        _request();

    </script>
    
</body>
</html>